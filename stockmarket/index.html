<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Hello World</title>

  <link rel="stylesheet" type="text/css" href="node_modules/bootstrap/dist/css/bootstrap.min.css" />

  <link rel="stylesheet" type="text/css" href="app/css/main.css" />
  <link rel="stylesheet" type="text/css" href="app/css/stockmarket-barchart.css" />
</head>
  <body>
    <!-- mount point -->
    <stockmarket-button></stockmarket-button>
    <stockmarket-table></stockmarket-table>
    <stockmarket-barchart height="500" width="960"></stockmarket-barchart>
    <!-- <stockmarket-barchart height=300 width=760 chart_id="chart-2"></stockmarket-barchart> -->

    <!-- include riot.js and the compiler -->
    <script src="./node_modules/riot/riot.min.js"></script>
    <script src="./node_modules/d3/d3.min.js"></script>
    <script src="./dist/js/stockmarket-service.js"></script>
    <script src="./dist/js/stockmarket-button.js"></script>
    <script src="./dist/js/stockmarket-table.js"></script>
    <script src="./dist/js/stockmarket-barchart.js"></script>

    <!-- mount normally -->
    <script>
    // FIXME clean the code (see https://muut.com/riotjs/guide/#example-riot-application-de)
    // something like StockMarketService.getStocks() and pass StockMarketService as a service to
    // the stockmarket-button???
    var url = "http://cors.io/?u=http://demo-streamdataio.rhcloud.com/stockmarket/prices";
    var bus = riot.observable();
    var areMounted = false;
    riot.mount('stockmarket-button', { title: 'Load Stocks', url: url, bus: bus });

    bus.on('newStocksEvent', function() {
        if (!areMounted) {
          riot.mount('stockmarket-table', { title: 'Stocks', bus: bus });
          riot.mount('stockmarket-barchart', { title: 'Graph', bus: bus });
          areMounted = true;
        }
    })


    </script>
  </body>
</html>
